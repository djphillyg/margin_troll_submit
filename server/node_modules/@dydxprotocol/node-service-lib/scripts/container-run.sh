#!/bin/sh
set -e

if [ "$NODE_ENV" != "" ] && [ "$NODE_ENV" != "development" ]
then
	# Try to retrieve parameters from the secrets manager
	values=$(aws secretsmanager get-secret-value --secret-id $SECRET_ID | jq -r ".SecretString")

	for s in $(echo $values | jq -r "to_entries|map(\"\(.key)=\(.value|tostring)\")|.[]" ); do
		export $s
	done
fi

npm run migrate
npm run seed
npm run start
