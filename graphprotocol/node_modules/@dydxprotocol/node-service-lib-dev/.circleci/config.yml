version: 2
jobs:
  publish:
      docker:
        - image: dydxprotocol/node:8.12-alpine-v1
      working_directory: ~/build
      steps:
        - checkout
        - add_ssh_keys:
            fingerprints:
              - "f7:3c:86:d5:e7:33:d8:f8:25:4b:02:39:63:8e:7a:63"
        - run:
            name: Authenticate with registry
            command: echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > ~/build/.npmrc
        - run:
            command: sh scripts/publish-if-not-exists.sh
workflows:
  version: 2
  build_and_test:
    jobs:
      - publish:
          filters:
            branches:
              only: master
